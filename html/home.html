<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="data:,">
<link rel="stylesheet" href="/static/tachyons.min.css.gz">
<link rel="stylesheet" href="/static/styles.css">
<link rel="stylesheet" href="/esmodules/prosemirror-view@1.30.1.css.gz">
<title>Login</title>
<header class="notebrew-header"><a href="/">notebrew</a></header>
<div class="flex">
    {{- if .LoggedIn }}
    <p class="mr3"><a href="/user">Dashboard</a>
    <p class="mr3"><a href="/note?new">new note</a>
    <p class="mr3"><input type="submit" form="logout" value="Logout" class="pointer">
    <form id="logout" method="POST" action="/logout" class="dn"></form>
    {{- else }}
    <p class="mr3"><a href="/login">Log In</a>
    <p class="mr3"><a href="/register">Create An Account</a>
    {{- end }}
</div>
<img id="preview" src="#">
<div contenteditable="true"></div>
<script type="module">
import {schema} from "/esmodules/prosemirror-schema-basic@1.2.1.js.gz";
import {EditorState} from "/esmodules/prosemirror-state@1.4.2.js.gz";
import {EditorView} from "/esmodules/prosemirror-view@1.30.1.js.gz";
import {undo, redo, history} from "/esmodules/prosemirror-history@1.3.0.js.gz";
import {keymap} from "/esmodules/prosemirror-keymap@1.2.0.js.gz";
import {baseKeymap} from "/esmodules/prosemirror-commands@1.5.0.js.gz";
import {exampleSetup} from "/esmodules/prosemirror-example-setup@1.2.1.js.gz";
let state = EditorState.create({
  schema,
  plugins: [
    history(),
    keymap({"Mod-z": undo, "Mod-y": redo}),
    keymap(baseKeymap),
  ]
});
// let view = new EditorView(document.body, {state});
// https://www.techiedelight.com/paste-image-from-clipboard-using-javascript/
// https://stackoverflow.com/questions/4459379/preview-an-image-before-it-is-uploaded
// Why is pasteEvent.clipboardData always empty? Debug that.
// https://web.archive.org/web/20160323212029/http://joelb.me/blog/2011/code-snippet-accessing-clipboard-images-with-javascript/
// Investigate whether it is because it has to be pasted into an empty contenteditable div.
// Then investigate if it works when pasted into a plain div, not a prosemirror div.
// https://stackoverflow.com/a/60504540/3030828
// Oh my god I figured it out. It's because the actual clipboardData never lives beyond the scope of the callback function. If there are any files in the callback function, move it out to some other variable or else the clipboardData will be wiped once the function exits.
let proseMirror = document.querySelector(".ProseMirror");
if (proseMirror) {
  /*proseMirror.onpaste = function(pasteEvent) {
    pasteEvent.clipboardData.getData("image/jpg");
    var item = (pasteEvent.clipboardData || pasteEvent.originalEvent.clipboardData).items[0];
    if (item) {
      window.item = item;
    }
    window.pasteEvent = pasteEvent;
  }*/
}
document.querySelector("div[contenteditable=true]").addEventListener("paste", function(event) {
  console.log("ree");
  console.log(event.clipboardData.items[0]);
  window.event = event;
});
</script>
